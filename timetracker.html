<html>
<head>
    <script>
        
let t = setInterval(showTime, 500)

function showTime() {
    let today = new Date();
    let h = today.getHours();
    let m = today.getMinutes();
    let s = today.getSeconds();
    m = checkTime(m);
    s = checkTime(s);
    if (isEven(sCount)) {
        document.getElementById('clock').innerHTML = h + ":" + m;
    }
    else{
        document.getElementById('clock').innerHTML = h + ":" + m + ":" + s;
    }
}
function checkTime(i) {
    if (i < 10) {i = "0" + i};
    return i;
}

function toggleSeconds() {
    sCount++;
}

let startMin = 0,
    endMin = 0,
    totalMin = 0,
    totalHrs = 0,
    count = 0,
    oCount = 1,
    sCount = 1,
    timeArray = [],
    timeArrayString = [],
    noteArray = [],
    dispTimeMins = 0,
    dispTimeHrs = 0,
    dispTimeStr = "",
    pctWork = 0;

function displayTimeAndComment(){
    let d = new Date();
        h = d.getHours(),
        m = d.getMinutes(),
        hrs = (h + (m/60)),
        mins = h*60 + m;
    let note = document.getElementById("text").value;
    let e1 =  document.getElementById('note');
    if (note == "") {
        note = "stuff";
    }
    
    timeArray[count] = hrs;
    dispTimeStr = createTimeString(hrs);
    timeArrayString[count] = dispTimeStr;

    if(isEven(count)){
        noteArray[count] = note;
        startMin = mins;
    }
    else{
        endMin = mins;
        let sectionMins = endMin - startMin;
        noteArray[count-1] = note;
        noteArray[count] = sectionMins;
        totalMin = totalMin + sectionMins;
    }

    printNotes();
    count++;
    summarizeDay();
}

function printNotes(){
    let line = 1;
    let totalLines = Math.ceil(timeArray.length/2)
    let e1 =  document.getElementById('note');
    e1.innerHTML = "";
    for(line=1; line < totalLines; line++){
        e1.innerHTML += `${line}: ${timeArrayString[line*2-2]} - ${timeArrayString[line*2-1]} ${noteArray[line*2-2]} for ${noteArray[line*2-1]} mins <br />`;
    }
    if(timeArrayString[line*2-1] == undefined){
        e1.innerHTML += `${line}: ${timeArrayString[line*2-2]} -`
    }
    else{
        e1.innerHTML += `${line}: ${timeArrayString[line*2-2]} - ${timeArrayString[line*2-1]} ${noteArray[line*2-2]} for ${noteArray[line*2-1]} mins <br />`;
        document.getElementById("textfield").reset();
    }

}

function overrideTime() {
    if (isEven(oCount)) {
        let e2 = document.getElementById('editinfo');
        let newHour = parseFloat(document.getElementById("orhrs").value);
        let newIndex = parseInt(document.getElementById('ordex').value);

        if(Number.isNaN(newIndex) || Number.isNaN(newHour) || timeArray[newIndex - 1] > newHour || timeArray[newIndex + 1] < newHour){
            alert('oops');
            document.getElementById('orindex').style.display = "none";
            document.getElementById('orhours').style.display = "none";
            document.getElementById('orhelp').style.display = "none";
            oCount++;
            return;
        }

        timeArray[newIndex] = newHour;
        let hrs = newHour;
        dispTimeHrs = Math.floor(hrs);
        dispTimeMins = Math.round((hrs - dispTimeHrs) * 60);
        dispTimeStr = createTimeString(dispTimeHrs, dispTimeMins);
        timeArrayString[newIndex] = dispTimeStr;

        if(isEven(newIndex)){
            let newSectionMins = (timeArray[newIndex+1]-timeArray[newIndex]) * 60;
            noteArray[newIndex+1] = newSectionMins;
        }
        else{
            let newSectionMins = (timeArray[newIndex]-timeArray[newIndex-1]) * 60;
            noteArray[newIndex] = newSectionMins;
        }
        let editedLine = 0;

        if(isEven(newIndex)){
            editedLine = (newIndex + 2) / 2;
        }
        else {
            editedLine = (newIndex + 1) / 2;
        }
        
            e2.innerHTML += "LINE " + editedLine + " HAS BEEN EDITED" + "<br />";

        printNotes();
        summarizeDay();

        document.getElementById('orindex').style.display = "none";
        document.getElementById('orhours').style.display = "none";
        document.getElementById('orhelp').style.display = "none";
    }
    else{
        document.getElementById('orindex').style.display = "block";
        document.getElementById('orhours').style.display = "block";
        document.getElementById('orhelp').style.display = "block";
    }

    oCount++;

}

function resetEverything(){
    totalHrs = getHrs();
    alert(totalHrs.toFixed(2));
    let e1 = document.getElementById('note');
    let e2 = document.getElementById('editinfo')
    let e3 = document.getElementById('summary')
    let e4 = document.getElementById('xx');
    e1.innerHTML = "";
    e2.innerHTML = "";
    e3.innerHTML = "";
    e4.innerHTML = "";
    startMin = 0,
    endMin = 0,
    totalMin = 0,
    totalHrs = 0,
    count = 0,
    oCount = 1,
    timeArray = [],
    timeArrayString = [],
    noteArray = [],
    dispTimeMins = 0,
    dispTimeHrs = 0,
    dispTimeStr = "",
    pctWork = 0;
}

function summarizeDay(){
    let e3 = document.getElementById('summary');
    totalHrs = getHrs();
    pctWork = getPercent(totalHrs).toFixed(2);
    e3.textContent = "Summary: " + (totalHrs).toFixed(2) + " hours" + " Percent: " + pctWork;
    totalHrs = 0;

}

function getHrs(){
    total = 0;
    let i = timeArray.length;
        while(i>1){
            if(!isEven(i)){
                i = i - 1;
            }
            total += timeArray[i-1] - timeArray[i-2];
            i = i - 2;
        }
    return total;
}

function getPercent(tw){

    let i = timeArray.length - 1;
    let pct = 0;
    pct = ((tw)/(timeArray[i]-timeArray[0]))*100
    if(tw == 0){
        return 0;
    }
    return pct;
}

function createTimeString(h){
    dh = Math.floor(h);
    dm = Math.round((h - dh) * 60);
    if (dm < 10){
        return dh + ":" + "0" + dm;
    }
    else{
        return dh + ":" + dm;
    }
}



function hideElements(){
   // document.getElementById('orbutton').style.backgroundColor = "red";
    document.getElementById('orindex').style.display = "none";
    document.getElementById('orhours').style.display = "none";
    document.getElementById('orhelp').style.display = "none";
}

function isEven(value){
    if(value%2 == 0)
        return true;
    else
        return false; 
}



    </script>
    <style>
        #note{
            margin: 5px;
        }
        #orbutton{
            background-color: red;
        }
        .dex{
            width: 50px;
            margin: 2px;
        }

    </style>

    <!-- <meta name="viewport" content= "width=device-width, initial-scale=1.0">  -->

</head>

<body onload="showTime(); hideElements();">
    <button id="secbutton" onclick="toggleSeconds()">Seconds</button>
    <h1 class="text" id="clock"></h1>

    <button onclick="displayTimeAndComment()">Enter</button>
    <button onclick="resetEverything()">Clear</button>
    <button id="orbutton" onclick="overrideTime()">Override</button>
    <form id="textfield" autocomplete="off">
        <input type="text" id="text" value="" />
    </form>
    <div class="text" id=summary>Summary: </div>
    <div class="text" id="note"></div>
    <div class="text" id="xx"></div>
    <div class="text" id="xxx"></div>


    <div id="editinfo"></div>
    <div class="text" id="orhelp">Index , Value</div>
    <div style="display: flex;">
        <form id="orindex">
            <input class='dex' type="number" id="ordex" value="" />
        </form>
        <form id="orhours">
            <input class='dex' type="number" id="orhrs" value="" />
        </form>
    </div>





</body>

</html>